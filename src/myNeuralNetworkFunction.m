function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 07-Jul-2019 00:35:55.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = Qx80 matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = Qx4 matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.keep = [1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 52 53];
x1_step2.xoffset = [0.0149253731343284;0;0;0;0;0;0.0142857142857143;0.0101010101010101;0.0125;0.0131578947368421;0.012987012987013;0.0125;0.0123456790123457;0;0.0111111111111111;0.0112359550561798;0.0103092783505155;0.0103092783505155;0.0103092783505155;0.0103092783505155;0.0103092783505155;0.0103092783505155;0.0103092783505155;0.0103092783505155;0.0103092783505155;0.0114942528735632;0.0114942528735632;0.0116279069767442;0.0116279069767442;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0];
x1_step2.gain = [45.5600000000001;28;56;34;64;69.9999999999999;41.4814814814815;35.3571428571428;130.909090909091;93.787234042553;93.0416666666665;86.1538461538462;81.0000000000002;40;65.4545454545454;65.7230769230769;47.2564102564103;41.225;47.2564102564103;47.2564102564103;56.9066666666667;56.9066666666667;47.2564102564103;47.2564102564103;60.2972972972974;27.84;62.53125;62.7936507936508;66.5806451612903;52;56;40;50;40;71.9999999999999;71.9999999999999;38;67.9999999999999;56;57.9999999999999;36;36;38;44;76;52;82.0000000000001;93.9999999999998;38];
x1_step2.ymin = -1;

% Layer 1
b1 = [1.4510969039468648578;1.3785706899305221196;1.2705741070975686835;-1.0340942355657563034;-0.81428541224098804907;0.93300053457138298896;0.65358939754044642623;-0.54877924837939096037;0.58254537612150991688;0.36041982922041349013;-0.15699398429808805733;-0.091487230141295200481;-0.049679204555607509031;0.24125920693703853392;0.3560494118211585679;-0.35848125467029506863;0.53542366358946813509;0.52486962460857122803;-0.68638758666565524713;0.818932085007089694;-0.83479884056061270936;-0.91849686910211381097;-1.3220865692423395821;1.2445832479380050106;1.331013066505571496];
IW1_1 = [-0.24274512032548434259 -0.18451286658268675756 0.30637196009527689622 0.21885349430540632087 -0.076373278693260340799 -0.14505573767517709882 0.30822890658491869376 0.16360870104503724698 0.079104357441604655765 0.26688283242822646857 0.20210462023105885132 0.20064848861143805281 -0.095574404362451986783 0.15572994592230823829 -0.25813951459293782431 -0.041336173176485024872 0.035587532312761134545 0.088214996468849532496 -0.4393722964116166807 -0.29685742382973367981 0.15025624101206069838 0.10764704774181904634 -0.40793677002034478551 -0.059259857617339171953 0.019426547713248538962 -0.005116675816780899208 -0.40599556998071978375 0.10650636244943402497 -0.25422964996846081354 -0.43176761815913872189 0.056762107377351579685 -0.31302057565916086013 0.020071955188290226124 0.061412307627330610382 0.089269160245245032792 -0.17267905486994730713 0.36308075858699401239 -0.25979727554474868478 -0.31271000693319805919 0.23492454783419788877 0.069722151662314768572 0.11389208871201771112 -0.22313835888284949682 -0.25284553011015442614 -0.085411054288850624117 0.32152860085605478035 -0.1387344331886394555 0.13615955504704235768 0.16505937554483132712;-0.25737465031557293926 0.20061421018564581931 0.13297914605370150798 -0.25819140648385990877 -0.1167001099914063561 0.20561892995181729749 -0.084725281359247200941 0.33817902433180352384 0.30305624552718873899 -0.19296322847856070548 0.066637705179146550227 -0.27687736719851763212 -0.08754150271507618597 0.087875124899050166549 0.099232606623705352233 -0.075334454312778825757 0.058751258060792344029 0.081973337708071941643 -0.19262975854817201982 -0.21675914035398441415 -0.29040040920429721627 0.31132463434426266291 0.31205932489550924913 -0.29574676685865558534 0.055936468217976841044 -0.27519435029557309802 -0.34452483941908940146 -0.097820894794494059332 0.25070379182588398148 0.19313704941656270608 -0.05200558056819176711 -0.23131418726429014976 -0.11904644143191876748 0.25418483388135848511 0.060616273019820560153 0.10604350413297024269 -0.044007183490282562877 -0.34407237658913558676 -0.16904852466579037285 0.32928793811043521877 0.2650617367656405432 -0.30691193741162536845 -0.3240139406936635158 0.14406206954690609079 -0.30604172781756361355 0.029975700717580197607 -0.07963091465945557057 -0.088419281014356559956 -0.25459771002448650101;-0.030794506840395776542 -0.22139565358608054302 -0.14968445122345591658 -0.059987329114290666165 0.0012004347574126211264 -0.1304621865716071305 -0.32377088845016621654 -0.23155296462313806893 0.141732065084588299 0.13973976021137893277 0.22943587632381393093 0.2089634890124968114 -0.14791529926798374639 0.35552564170166295332 0.072322432735779901281 0.35188757582132168533 0.38347771369405009301 0.19597322849095713537 -0.07032349640379209621 0.29739690154783632314 -0.27623433906600225463 0.15200622228498456012 -0.33913099981037514441 -0.40043589079177865919 -0.12672743497901123311 -0.035677916929191498541 -0.2453848449325504999 -0.40859043345997692054 -0.38183515690873270909 0.12128821466825924491 0.25274988947100257564 0.23005642992008598635 0.11878026640297691119 0.045137612230522566881 0.055202914162327962333 0.40606316419887422686 0.35176333309517310299 0.13772151505772239899 0.45736964228332621651 0.1968903739967927391 -0.2355561344689960368 -0.16676276990548272172 -0.072086633261347454749 -0.16546395920740322727 0.23892170254277189656 -0.068632055668645372548 0.082567536911514430309 0.056602717396875751321 0.031223600584596514218;0.22068262731396798282 0.33186613387742619485 0.3402917341697150877 -0.17709766790937786496 0.31314786650897696862 -0.011843093184827232361 0.037913752306087643296 -0.29575993430066549461 0.2080968405790455944 0.097957846814123714085 0.23546125469143119879 -0.40313570760204270327 -0.16085963711864942338 -0.30455164419851088464 0.1467493481902210628 0.057826733493565943278 0.088404807447230698836 -0.38877601551076385045 0.19926282716960833086 -0.41981903775519918698 0.028446361811856980817 -0.31590830727898605579 -0.23876623711361108504 -0.40220432794256694153 -0.29369368467776418852 0.082078503410149619701 -0.088047361270292487379 -0.060461613068442741914 -0.3747638633446300771 -0.20070174823017411514 -0.30036904829140625983 0.030679416184917020216 0.24699598912200429468 -0.028444344366684547187 -0.26562973183727395243 -0.36741928440276666601 -0.2825344950941509059 -0.21106557658513341869 0.10019845004539826294 -0.15509443213406745588 0.19694977562130847049 -0.24552494380641498584 -0.2959279337963334755 0.042809853938816255781 -0.14442187173734941097 -0.088478158331101966483 -0.026809781385628665695 -0.26934488427387909271 0.22371582617797164394;-0.013709838078169325412 0.16199230637557268664 -0.017868320143597866273 -0.17761315195261537236 0.14269616296143780576 -0.32392048070636114687 -0.095838252489989103622 -0.024044294020106403431 -0.12094480187384301639 0.08050668689269221967 0.15800916328768338515 -0.23821219701153084625 0.13194361560054884697 0.32468689322195898317 -0.20425590154553979749 0.25595983464871691071 0.20960799065194885005 0.37962091723205787508 0.29042698997194232868 0.15064697823121286913 0.46661007001910853598 0.31373188066110641037 0.39743319433547491526 0.31350668191383113115 0.30677466804894637509 0.2991460773070108714 0.39968736632756390881 -0.0077048777859004607613 0.40000163264628507687 0.30070146274710257694 0.23523243028903814689 0.14235209455668346168 -0.21100698463776892955 -0.088741941439488741805 -0.045010510149542173886 0.38067019159411519258 0.20399209264594744817 -0.094931520577198350019 -0.021148576901122394245 0.0098968771306427467255 0.28717635918597816946 0.32875638371950105521 -0.2243600344500571997 -0.066196887311254754005 0.027497530131427427164 -0.27074383267010215803 -0.46638305909022192974 -0.07063622583835020563 0.033442821205096985582;-0.49149779670937476794 0.042024990314988804052 -0.38630627219394880756 -0.023483804860291820904 -0.33483629160802591551 -0.54956080577266186449 -0.39303541711249723178 0.067797289590838999418 -0.52048605603523767638 0.023535006595754678904 -0.31849289866362517909 -0.063463962979768973049 0.02990305416520609022 0.08953749516039118117 0.08813229753186142823 0.2427400207220158368 0.27893737656486305987 0.26051216146353384229 0.031382379464249633705 0.14931136476509027089 0.31004570274387810436 -0.13351564201162410828 0.077865234163705152048 -0.232955629990549834 0.35476938622545794999 -0.076969612901439943276 -0.3537937863456430132 0.16538096483999834008 -0.52516953551594269811 0.18694263356014101385 0.24830900895458085653 -0.0044597489006214250176 0.0071621472723303845898 -0.064454927477551215986 -0.27809412043080899979 -0.2205814447393115163 -0.071643062361713777397 0.068614917735352651262 0.19758844880048873072 0.42350645845239054399 0.035692216562044618011 0.16335275339709257048 0.30341419051805368357 -0.02750072673099403231 -0.28916458033343794831 0.27243460017187526301 -0.29474345585089917199 0.29180338449491832753 0.079424434419741660185;-0.27263568530990811567 0.19329309333986308128 -0.076230386524717683172 -0.19253075153674159559 0.16907247683418327733 -0.28788009194516911426 0.30607791272044404529 0.15806164984034429266 0.32978523457678826647 -0.069476551395744545747 -0.25785584017941015622 0.28975370377190146076 0.45682837618774296828 -0.25604041558561063674 -0.11894723094799909691 -0.23675347962758194753 -0.24450554099686069853 -0.37635508430492337073 -0.19613370045988023915 -0.0035982956318876334161 -0.28926659340467925086 -0.4164443861922861867 -0.023345866380658063938 -0.31577574116972306761 0.0082569584014478541317 -0.19008662570957116089 0.13232001642667379215 -0.10569049370204862404 -0.014798668163666343564 0.11399832689172068045 -0.21974822763681847726 -0.017798476974520346938 0.28867046702080639831 -0.23707297256064802093 0.072062407601719516426 0.2235708553316329561 0.33130828662041089672 -0.23611289827985504353 -0.048242166972254099666 -0.34342839418665405127 -0.25236491826355333945 -0.24899580313434166445 0.012012596084362290108 0.24997309309631565721 -0.1746327616413639594 0.33320812598710974894 -0.24862967346111303213 0.23900698719966179118 0.074747378698867827929;0.28387219653808937192 -0.099896352051999481869 0.23665698553181996333 -0.14917398512825932877 0.4431254854189203285 0.15832529985944801543 0.39532068289557126262 0.31770302551976009608 -0.17128730614368078977 -0.12728277519148195607 0.063194803352772693783 -0.08486134355683132291 -0.15524092607977055258 0.088407175127048168162 -0.21498800692603126095 0.28715918367056458838 0.29514956842658246483 0.044856149264968142587 -0.28906005279950408582 0.3676286229919105697 -0.16225354681994230699 -0.14210804865164947119 0.13057066339368589292 -0.093954485621496316994 0.048146805986878024597 0.1853058963839450124 -0.11783141841849568976 0.3545301901999843297 0.40657883883355072641 0.11117493898817022713 0.18646967241397574555 0.064989447359612290134 -0.2189209801124058774 -0.44689382031976709886 0.33350671280661731144 0.22598369123633954558 0.13348203888824036745 -0.16438669185864940303 -0.11357446773987990574 -0.29436780532447920367 -0.17262033581210423083 0.045592887647265975537 -0.41537537218809633677 -0.079278783997346627399 0.23407395326948868264 0.0040550158615299675136 -0.13862323117048910848 -0.17076729433144113846 -0.25922765698351057928;-0.075049115169431773742 0.19384627968876716464 0.10944876876803441568 -0.21921811397588411574 0.0696225997664397106 -0.14361379896187964622 0.29425803224927743473 -0.25449766438347187769 0.15196035149997638714 -0.034362565714655686488 -0.3296731156535481766 0.043068377853020277379 0.17380574377040380885 -0.053376622058225263456 0.32166242115542675872 0.35675448042195589959 0.084417653318405200258 -0.10958142388389534305 0.22309734075472353876 -0.24017726220945009863 0.33434169220742143702 -0.13002261498008982343 0.23217427101238405363 -0.1638346180198365365 0.45629099568764397432 0.28927645975737109607 0.32926769262593047483 0.33416382200058397656 0.09494698922287546361 0.37493409432969132533 -0.35094621689223903793 0.10842807928372685811 -0.39319586566549658002 0.15896476851638149941 -0.48122882023807395102 -0.50666048916606998276 -0.12296447580691532986 -0.036432017918297983361 -0.35756267872549213349 -0.16738123737566917848 0.12788960205680330318 -0.0024040819114925600017 -0.051761907985327093584 -0.097484480569527118266 0.17331116611834765373 0.27169984096526977879 -0.1041860794133588064 0.058917716618313978327 -0.047154184256777233186;-0.27624676398423175794 0.045601911132514584557 0.18043339991959775337 -0.27058579916105124363 -0.068036594637133143704 0.16058660315301967469 -0.38018534137035436826 0.12568309428188964572 -0.49023576235110782884 -0.38408746107822899774 -0.38982087508181872959 0.15573183233543769211 -0.56181995990563260435 0.033167296897367491704 0.1441589027837738568 -0.10755458338627446602 -0.25405177479394452922 0.14375370175302285003 0.096133852964714758271 0.33522355001007886344 0.30909365820986173246 0.18647385395391646856 -0.25457081891119887063 0.41800627749967572688 0.0069113430581129210728 -0.024396445685541865572 0.33868079632922565292 -0.17376647830680472251 -0.23466184721681462855 0.065161024547238544091 0.075198927150387728791 -0.02738713181629520016 -0.1653357866477772331 -0.32978532954340206151 -0.6219006196632325123 -0.1855744286441147195 -0.15116640040803744349 -0.3528311504888200778 -0.2907030723358646207 -0.13567899739619257438 0.029886814232259768104 0.49502721956167033968 0.37520473501353562851 0.014300823178096675262 0.40823330491598674996 -0.013071951227469891937 -0.25726582858216467953 -0.089790811625837005372 -0.1868676169948150223;0.11737365567853082216 -0.27228522637262492223 0.27669192068754644431 -0.18887546580754743797 -0.21397054271749424426 0.15901924419021160051 -0.34354928610695573132 -0.24290223645608829961 -0.55235452468814250082 0.14720913022366080569 -0.23996493499034615704 -0.29512996782793826656 -0.0088489066924488449239 0.23707409701118531409 0.10646063595649839228 0.39671079616868476503 0.30178333604310536575 -0.12149404258566010029 -0.1248808704820682236 0.1178164877999117871 -0.014551172198223804796 -0.14691562508632080575 0.10833052813983183593 0.22427452916210252609 0.12791866181076444464 0.31622029951712932183 0.33118657586333166698 -0.2049777172696955474 0.36607572662465659441 0.031522007553280773084 0.050119680767438508362 0.0079170765615712082597 0.29742476294550312943 0.29004028297909079104 0.32549141399921549533 0.3837126698457879459 -0.18066305336420113159 0.22834187217520990343 -0.29024257553589360992 -0.23836121602252893781 -0.0021484369986195604035 0.4105530306965503029 -0.17724829879043271785 0.20708827105684751713 0.1569405243324289434 -0.125473117646008131 0.022030959499657071926 0.25787983456597235454 -0.21555372303216205343;-0.22614971981087453323 0.2580317752181016111 0.28125890663121166924 0.30618332672305959008 -0.41470776830356703702 0.19234889273250943553 -0.21302033591887239994 0.043155094852567979502 -0.11321694901368456465 0.11383937685385385474 -0.31607462886942128133 -0.26858967345882006628 0.31817802246620696671 -0.45067855281234647791 -0.16010848866412308311 -0.28245747405415821962 0.049532383457243117642 0.0062454943951323728737 -0.046613980386653382226 0.06731303815265470003 -0.31444261971926890098 0.13648079503945323432 -0.34076299752531069576 0.12317355901465250334 0.31677270956422970416 -0.26886103063137339886 -0.36608894873513125878 0.1474392645677815028 -0.42505249427231400761 -0.083500219235571909726 -0.19755727588944624329 -0.2620502213198687147 -0.18873032713651480274 0.13289046619369845881 -0.49828045885888999633 -0.42647755105270840348 0.39534670170370983522 -0.23596673717125565828 -0.21673471158254370428 -0.087220960407385528246 0.14582089932527367293 0.33608180059404596518 0.014900396300555746737 0.16074887177466540278 -0.08918326231894990741 -0.092970295085847143302 -0.092617805382153819971 -0.20114794860755175199 0.53888877066300655549;0.032889950528171986444 0.32144369312994586219 -0.065872064597735077718 -0.03746354392971792957 -0.31116863410900924558 -0.073346093229593511964 0.075684226635116119697 -0.27194983418716539569 -0.24009394147284418564 0.10308438572633368824 0.26512080566983192709 -0.1268920402429721539 -0.052954534292291473296 0.18668997752268462476 -0.25309830372020397649 -0.033640281469364846645 -0.30392783817200647034 0.066197388782388094652 -0.28201401580370122346 -0.27356484848356199535 -0.22499491511490776752 0.057729718437469698666 0.16003613773733982306 -0.0089297416791007475784 -0.33568509945683011608 -0.31765424280447046579 -0.11651644793898180419 -0.0070828333216329496247 -0.19806758198099139179 -0.24560819769899963627 -0.20164005785943173166 0.29339495278150662383 0.33972323240569307634 0.45125744028046888001 -0.1503273819569697356 0.4568737772529737895 0.42189696234788570672 0.17208657085801540298 0.065064648913333425484 0.49417574104474892849 -0.12135641616192140158 0.16423134206035755467 -0.18607876584230043093 -0.22712207223293034986 0.093505613847160315433 -0.21418239065115352027 -0.2255681636819025504 -0.17814789197258584785 0.35707657161760175679;0.012454268574850565696 -0.16409831690642762148 0.35847256567537055805 -0.10671648461194344071 -0.28148178343349866681 -0.18159022221648479789 -0.38031366097780555657 0.11228485313703659432 -0.55796477356374207801 -0.24985094858507964077 -0.024033618882213187568 -0.29341040372132087821 0.18013607782590648765 0.19686936097811399971 0.076274833791620130774 -0.011803358223463239138 0.38823750501191450768 0.013802423780640834389 0.1999978288848087149 0.058614775695744247841 0.26547814827410254335 0.37721173368954097338 -0.041718152498707458675 0.10173835157351537872 -0.021614429619791354631 -0.20481757226895444535 -0.023547008960356857754 -0.22761179005862886005 -0.18036380009454019979 0.43371849548302238153 0.041349712635869624588 -0.28470195034780548804 -0.038829645030724641019 0.2081695233792727473 -0.041488812845393185924 -0.1612252864104918304 -0.38843643197388078026 -0.38238364022584803159 0.10918729610916914907 -0.4467215972940521973 -0.28404243373723075949 0.21135562402746294053 -0.36794855390728181677 -0.29247602511913345369 0.21403748807074710059 0.11391910820028008922 0.18181882066961990718 0.10230766825524270636 0.075955708913603786625;0.26638540322328047028 -0.095302928862150262934 -0.33805812071027513399 -0.31769984277557961061 -0.063777054947110334293 -0.24558641427170366245 -0.20901014630296871344 -0.010487466432260481725 -0.055534787158068782409 0.062951831813206293731 -0.053838012847579094777 -0.26756696151627040736 0.086861792495874862174 -0.029475161303790305134 -0.03461097415375204156 0.50297183961565328225 -0.02573235417766039923 0.027965116019277473647 -0.026530490953952191868 0.27921494280503428298 0.4256332281776260551 0.16448750228581843214 0.39494595038441510093 -0.010879547331627987053 0.49970640593639059635 -0.053160656900988270679 -0.13388565074742686534 0.43229364183206819838 -0.018678456550260649077 0.11887137965302044251 0.21065593158314457889 0.041551314516936443955 -0.04488354338296053625 -0.3173262818881005809 -0.24832274682724214676 0.29426380411079977595 0.18960795449748438224 -0.19267089321746522224 0.077063466392342669375 0.0045099233216914363931 0.316225113283906345 0.43368827902519657691 0.083463822832204881408 0.040050651431313165352 -0.10516511477252971085 0.12689422840842629059 0.27275809260799899203 -0.39424580330188491173 0.23171930554171657479;-0.35597153246708573837 0.32932587676195707038 -0.42638066573580168939 0.2582872828165594381 -0.53369534769789983564 -0.19645312435562500841 0.087919122319803727494 -0.00204380955705261904 -0.78886711868438696982 -0.34742281402379660005 -0.35177711799689725947 0.10218204435587706358 0.3239811774699360436 -0.15859912125655567516 -0.11483593331371605428 -0.57196151244739057429 0.075199732257668877589 -0.37156778813295815445 0.32788583073982485727 0.30108211444768717691 0.052400843688343079485 0.13876161824918989418 -0.15753881526262739077 0.11895410044286085227 -0.22313761196014397781 -0.19030562408683557307 -0.093789703938102209069 -0.015488797858499740376 -0.37493222765767858506 -0.012779375121309555219 -0.067070128935629885758 0.11277098692655192214 0.0016816964727475736119 0.010955603048953070286 0.054367492454219595865 0.037046702409498651065 0.51615721740084508085 0.038990904132945418403 0.1324688199450961279 -0.22872203085130468625 0.29316314618539912606 -0.10998874552396151194 0.11633070126873054639 0.26319468497118464478 0.27759517034712349881 -0.0075613053955794666885 -0.32935989428566980752 -0.021421509739267437233 -0.22124221162986218436;-0.14350333675223247987 -0.17268096779157024456 -0.30711672310885629322 -0.19848694492719559657 0.036082882739943908379 -0.07756288095365815316 -0.20638702309167603066 0.015995619912416915442 -0.83246098828964287808 -0.32265204480108772289 -0.028999099083264989057 -0.58102698802640462272 -0.14706154369249627156 -0.013106461659847877532 0.20322199748993516333 -0.20442253943511717873 0.0056561803844757110524 0.07584749068111841519 -0.22134818526132665761 0.073373080345270944025 0.20697513785446247647 0.47612696708320001449 0.2087242559322032287 -0.14105907605870263155 0.047757976055991580022 -0.22226874456695086546 0.12058654647787525604 0.062344984674877611253 0.043030492812390269686 0.12426538829353453441 -0.25887677815991350094 0.12864821817984006813 0.30014876071052093431 0.36488857768944049642 -0.4152933654258365026 -0.39431876744596483508 0.18301352449848179438 -0.088591030966832282068 -0.15099587651630955176 0.3348199341280815311 0.04293368123843165074 0.17050959982936286785 0.20026921195523622599 0.32143276830606132277 -0.33458600978498620471 0.21866705865271623965 -0.018276472275520452143 0.18580825590877481091 -0.0010136556214125876443;-0.030625346745832865425 0.62283810494806224334 -0.05128308267196136222 0.21693991169749193837 -0.12634738311532553445 -0.45536245306702105573 -0.23028430613791850412 -0.45991575748751750696 -0.78700248363783398275 -0.13792629118616803185 -0.32942942942745906398 -0.26535576662262466696 0.33138006284063870055 -0.10396041558735212573 -0.28697669852187190909 -0.09965628781575337769 0.26519208130368132625 -0.053203202754259500129 0.30323367292019703934 -0.32318024410875223484 -0.17545213082283253603 0.029805602549243085525 0.3673268982008640049 -0.28701345332364769369 0.086083823706035622614 -0.023878982571792516099 -0.41598953171033009601 0.078743773395866786813 -0.52433962568979430863 0.24330466360640384815 0.12135326783793115579 0.1642222961332890363 -0.18790907571774850826 0.35092525600989188383 -0.35315430644398132509 -0.35281857943232397545 0.47111605603510314788 0.062509229930133122788 -0.14386568341944200311 0.032383930583302342199 0.5070575448515626249 -0.26726131607409842061 0.36459048348418776619 -0.087354456786453787975 0.49360348524340691423 0.010479486830522081325 0.40151224680398012179 0.17871783249036754526 0.2165822324756663253;-0.17097180664184474796 0.049797225397634467536 0.077468827962118361197 0.10058471396422226374 -0.2554635082804740942 0.075515695801039187107 -0.16944308945305178171 0.36053290107192881297 0.25331761671840757888 0.12839036250866467381 0.48645766709850635223 -0.098036862993980497527 -0.15860614428387267982 0.29840272868496969805 1.3615679528522668662e-05 0.19411298602977652972 -0.28899850881109101497 -0.20495359860573400534 0.098240745136182333619 -0.25566954502693667317 0.21570164633336649795 -0.10846387501965214228 -0.30432924803936989289 -0.3111980803582839461 -0.18793937099017221648 -0.20733141189778028779 0.12802039373183940474 0.23588609425393258778 0.079657481359570958546 -0.067237078581244433262 -0.23881254776088081671 0.40008998158846931226 -0.15316950757865216426 0.23370742654537787764 0.22914942219931563883 0.25017784521872105108 -0.25421050587627325168 0.36612958362081038377 0.34244889673817940912 -0.078136600101040995514 -0.41008031950046869296 0.17859529537391530263 -0.086143524836264695477 0.10037488265475552618 0.22749848634454267193 -0.023228733250838067004 -0.25923237912737806532 -0.30577902985145966053 0.21584200160951017011;0.29906130417133430788 -0.024889973498282019077 0.31501717378406862702 -0.05776632471250370271 -0.30913367065612068485 0.22081022611933523447 0.048400411375685896409 0.083197556158204177823 0.39155516270449924887 0.5633363123296046826 0.55616935140154299955 0.50331658793729261436 -0.18546201039073265115 0.22080717718082343293 -0.035193584031487937236 0.27725150320207303523 -0.16076273948913208378 -0.08917673009985112309 -0.10306381388621241313 -0.028318500494882103968 0.063197235725825751107 0.17008399869114584901 -0.53789790633500167427 0.19423732651926933768 -0.18530643411574621027 -0.058706662429298284156 0.27903124820696395547 0.099703123983791538953 -0.10914881610847125548 -0.49085950975013614705 0.29627606743110401766 0.48212159034065510399 0.077008387012024351326 0.03934357210642971947 0.39751895301377992986 0.286705289840157862 -0.27121113494331017257 0.37173443687262253121 0.6164300144504494261 -0.13044114975026163683 -0.10292410312954305973 -0.21778793915155927885 0.068801653104703833219 0.11689203462583798443 0.10308172678596386196 -0.21379786525583063805 0.32345800582491662789 -0.02726534332422277801 0.18365544786441032055;0.045427403559225684737 -0.35604847161374358899 0.035486317606255007862 0.24273098734766085371 -0.17890318067820126791 0.37504954012270141916 0.23394495041126239787 0.099815659104293061321 0.2319033219681633784 0.19899004200088352134 -0.047532251530694714925 -0.20800931825090246408 -0.20843891907961162313 0.058815817466757319698 0.057219651946267754972 0.57274300569890113088 -0.38083323133759700019 0.010112099042079679412 0.11241914205199454724 0.27662864813136828213 0.055922644782350941495 -0.28954956978475737683 -0.35987069468895521718 0.37406157099936288013 0.25618808075701904325 -0.12810048088172276692 0.029205208688758300256 -0.095853951233161358014 0.33229228493901208363 0.33346995331085227399 0.002549000668437253949 -0.31196389091449444608 0.11596445491342086132 -0.39292511543651648109 0.35543725259775516001 0.58268721708407189563 0.061861196788028989524 0.29233045691202108607 0.14033722092292408301 0.16085738061186483083 0.10884445761233206562 -0.11833231776562677662 0.091460432146365330808 -0.25383445595171089115 -0.22267043161563435105 -0.020665731611095503745 0.069308377643490501341 -0.19840061757118704344 -0.25882968099204534118;-0.19863332613151510331 -0.062615587421813861946 -0.054746675659594415397 0.15324684892120041257 -0.034802374564500804244 -0.25933364874945513678 -0.50598376242599252262 0.030641078112359859675 -0.40332265502211167574 0.27409279246615853021 -0.085211676818213094586 -0.12709755178280532362 -0.089729794522120501221 0.0025086585947818062538 0.35007508048725000105 0.53370320600615406281 -0.14077870822367277714 0.039321436136681854612 0.18683825162718858959 0.18700902080003922734 0.051081556942196147675 -0.046659237774994269388 0.17972169597263257246 -0.27984328662056279224 0.053700572937363834358 -0.20632440657678344231 0.23792599499317648726 -0.28817312054476529326 -0.21988170811558652162 0.20724458656368735521 -0.19057334228901001705 -0.44061943761687616394 0.30794294244187525589 0.06092082645994639778 0.21419545337696946352 0.30837589323881303693 0.13782217271651350798 0.48432481963997259244 0.38923324202350800816 0.33871813878243173246 -0.14867492261786938168 -0.22644085424675219897 -0.071826805625161346813 -0.19680396379901293757 -0.33913930335409164796 -0.4123564154427306061 -0.10147456672853789883 -0.13424839368002697282 -0.010288899488147646225;-0.15526930889461187935 0.034581933136603605627 0.029911061490364373311 -0.0021889043385014228353 -0.29507131993844198936 0.15726607164398373473 0.055311813059530298697 0.32236696711805312709 -0.22787227210204885619 -0.16758165596759333482 -0.088697435718344458389 0.41259868365770691057 0.29076928643483135328 0.32393206752172964968 0.32644985741303250704 0.064625763071883182698 -0.17597062175415870144 0.22682158776770841579 -0.31056795651997087804 -0.13127915471418538651 -0.065414175243611788479 0.3332000258892866551 0.075380809076446647632 -0.018350118101650100128 0.11662696413928667905 -0.28467985022802699824 -0.097331761759902893361 0.15928599896504075373 0.25946906983881479203 -0.15951513036722655969 0.27748524815581115943 -0.32718628546422356962 -0.047707852197361025337 -0.20773665433306226502 -0.12672585907887107259 -0.026578679138797085824 -0.17385764851997367875 0.13636249722167020915 0.13341491033174066039 0.19688659726844165432 -0.078567485613887017015 0.043667162615792516622 0.36444797739433781869 0.072473765895458772124 0.24501198570954577094 -0.26749975994648722555 -0.30519632819201286678 0.14241724867372940189 0.31912648387416869822;0.16336923186206714353 0.44843150521145208609 0.073147159482487872362 0.24314733987332748377 -0.4727818286503014944 -0.027809419454471188266 0.31014126370819278256 -0.23265687184128286402 -0.35624939828765922467 0.10079682611672141634 0.13798973327221586427 -0.058328425456737532928 -0.02373987447778588139 0.015060693496834844096 -0.21832804079727530233 -0.31792153678946399875 0.40206301124116988754 0.18207373630033760192 0.30263498451246517718 0.33209860669500840258 -0.19534332761298628389 -0.13415443618100933443 -0.30534818389893764179 0.10019287730801698655 0.16597006885051779346 0.096633487222787847748 -0.40510500827257545087 -0.15434420539612944689 -0.42710754371150688735 -0.2414306426446265752 0.33649210422775072127 -0.078147253000149546898 0.10884369512842782812 0.18578012808153662738 -0.1685163139507740715 -0.041100344825892101697 0.2646344010381875278 0.21894288979776213577 0.16676385953000502638 0.37652773801475603044 0.17389896469011548175 -0.095974449846337545056 0.11247955163341732954 0.24440730618267894614 -0.24741652914468728608 0.2135615212320166878 0.036207922278032628194 -0.20309827473490982275 0.20654794019788805248;0.36025803318800586617 0.29268006717390071536 -0.37789411680219392453 0.29856512514184929685 0.093926591421541638649 -0.10732202594701323317 -0.18403358084373544479 0.075483419534720846977 -0.075546917710298130966 -0.20225645514388013169 0.27816093888098047948 -0.20896921507595778156 0.09525083469614378795 0.18131668504300951783 -0.21080169865394518536 -0.38988044525473092294 -0.027778165103696947358 0.24160475793281502299 -0.33900644053338480077 -0.032823891577645536444 0.03262471840322485328 -0.21253710098918565663 0.16023242801686810033 -0.17841388721153461638 -0.24820800221840327859 -0.11304072921669124085 -0.23485627080490009688 0.1552817626000632667 -0.12985322664410686722 -0.30257542173385926221 0.30519448334643717313 -0.24397289455239068445 0.25099560196304254722 0.25839572210680716857 0.18253728664930443659 -0.15053101371309762779 0.049899351722704085588 0.31559227927927169244 0.34589635345954922174 -0.1765126965724941599 0.34211713285408340557 -0.25681626200829649198 -0.061751763419391328402 0.32914225878243891232 0.084805243281692588297 0.18828218402176216673 0.4381660083102754677 0.38177825897344014328 -0.10487240025525515486];

% Layer 2
b2 = [0.2236762575916080853;-0.0064725482685000987337;-0.82065870812450214533;-0.22383899691235695228];
LW2_1 = [0.71504564431171035999 -0.37616945550197417036 0.4518022423976039148 0.64224994130096346723 0.3291441634848539799 1.0281838049681712999 0.22514246956881953099 -0.56077957820447354997 -0.79665601422142340304 0.52814488067088027901 -0.067255089439038767685 1.0671097216829283916 1.2333049227369301537 -0.011798474023911350098 -0.20052660248331233284 1.7058653071977494253 0.69474901731970462038 1.7586819515907401446 -0.78301946974850200611 -0.65153912000240632452 -0.80907897153326924222 0.32395546155650228881 -0.49833056284149657156 0.55219645997359256828 0.8404584845923318559;-0.79068079496989107646 0.86629286406825611877 -0.02494698753168788502 -1.3161518904093045812 1.343960015264087815 0.92341522703401990313 -1.0360167344474717765 0.45057278090733476894 0.68164147577494238472 1.2154416834859094187 0.70621725575199578717 -0.71048629111062400199 -0.066117478014072569859 0.72603853686775465803 1.042985852130416724 0.081180591104619614917 0.44142871219283513762 -0.31568186585626567542 0.50067436023351841179 -0.76622577947044590019 0.26048195986541655689 1.0380466814236586348 -0.25313509051940219496 -0.58792267310769374955 -0.17210117208843175862;0.097480614527304346173 -0.48607388366513565314 -0.2366240053458166237 0.42062726479282080971 -0.28493133340564957834 -0.45825759255681519644 0.14786659507670407709 0.10757600828017752082 -1.2396053057828608779 -1.4564754566753481679 -0.49404200519701974015 -0.83229014739302775716 1.1234267300959122071 -1.2785724879449196223 -0.42045216516760874903 -0.54782864366824002289 -1.3527961017539154032 -1.4637542169748558596 0.35131650867239083702 1.6021789782068585062 0.33949880663684478543 0.48303270267352427236 -0.96368322281299789722 -0.11150942212615930216 0.25232287911415579584;-0.77817737246170048948 0.6389386709416531307 -1.0050940713669163085 0.49861902298388149912 -0.65205405876589661585 -1.0220448649881981318 -0.060243086018352251521 0.69851624830562619728 0.82713297206775560078 0.96203708723131775571 -1.1080895919266111616 0.45170311419561071098 -0.8267307480521375318 0.37808486062854856913 -0.56122516956312806791 -0.80712611913578213851 -0.65095071044271379801 -0.86996420054923528919 0.053078442025797117898 -0.6875067044857171572 -0.37603969034176903952 -0.8508812982551811066 0.81064865446972100838 -1.0779128577349650353 -0.080696019026755716474];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
    X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},1); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    X{1,ts} = X{1,ts}';
    temp = removeconstantrows_apply(X{1,ts},x1_step1);
    Xp1 = mapminmax_apply(temp,x1_step2);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
    Y{1,ts} = Y{1,ts}';
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
    Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings)
y = x(settings.keep,:);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n,~)
if isa(n,'gpuArray')
    a = iSoftmaxApplyGPU(n);
else
    a = iSoftmaxApplyCPU(n);
end
end
function a = iSoftmaxApplyCPU(n)
nmax = max(n,[],1);
n = bsxfun(@minus,n,nmax);
numerator = exp(n);
denominator = sum(numerator,1);
denominator(denominator == 0) = 1;
a = bsxfun(@rdivide,numerator,denominator);
end
function a = iSoftmaxApplyGPU(n)
nmax = max(n,[],1);
numerator = arrayfun(@iSoftmaxApplyGPUHelper1,n,nmax);
denominator = sum(numerator,1);
a = arrayfun(@iSoftmaxApplyGPUHelper2,numerator,denominator);
end
function numerator = iSoftmaxApplyGPUHelper1(n,nmax)
numerator = exp(n - nmax);
end
function a = iSoftmaxApplyGPUHelper2(numerator,denominator)
if (denominator == 0)
    a = numerator;
else
    a = numerator ./ denominator;
end
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
